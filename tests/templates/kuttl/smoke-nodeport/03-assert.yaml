---
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
commands:
  - script: |
      ADDR=$(kubectl get listener/listener-nginx-0 \
        -o jsonpath='http://{.status.ingressAddresses[0].address}:{.status.ingressAddresses[0].ports.http}/pod-name' \
        -n $NAMESPACE) && \
      echo Requesting $ADDR should return nginx-0 && \
      kubectl exec checks-0 -n $NAMESPACE -- curl -s $ADDR | grep nginx-0
  - script: |
      ADDR=$(kubectl get listener/listener-nginx-1 \
        -o jsonpath='http://{.status.ingressAddresses[0].address}:{.status.ingressAddresses[0].ports.http}/pod-name' \
        -n $NAMESPACE) && \
      echo Requesting $ADDR should return nginx-1 && \
      kubectl exec checks-0 -n $NAMESPACE -- curl -s $ADDR | grep nginx-1
